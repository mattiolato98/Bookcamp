<script type="text/javascript">
    /**
     * Ajax request to find out if a username already exists.
     * success: shows an error if the username already exists, otherwise removes the error message if it was present.
     */
    $('#id_username').on('change', function () {
        $.ajax({
            type: 'GET',
            url: "{% url 'user_management:ajax-check-username-exists' %}",
            data: {
                'username': $(this).val(),
            },
            dataType: 'json',
            success: function(data) {
                let username_field = $('#id_username');

                if (data.exists) {
                    username_field.css('border-color', "#dc3545");
                    if (!$('#username-exists-error').length) {
                        username_field.after(
                            '<span id="username-exists-error" class="text-danger font-7 font-size-80">' +
                            'Un utente con questo nome è già presente.' +
                            '</span>'
                        );
                    }
                } else {
                    username_field.css('border-color', "#e8e8e8");
                    $('#username-exists-error').remove();
                }
            }
        });
    });
</script>